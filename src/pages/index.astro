---
import { getCollection } from "astro:content";
import MainLayout from "../layouts/MainLayout.astro";
import HeroSection from "../components/HeroSection.astro";
import TrustIndicators from "../components/TrustIndicators.astro";
import ServicesShowcase from "../components/ServicesShowcase.astro";
import ServiceAreasGrid from "../components/ServiceAreasGrid.astro";
import ReviewsSpotlight from "../components/ReviewsSpotlight.astro";
import GalleryPreview from "../components/GalleryPreview.astro";
import CallToActionBanner from "../components/CallToActionBanner.astro";

const services = await getCollection("services");
const orderedServices = services.slice().sort((a, b) => a.data.order - b.data.order);
const featuredServices = orderedServices.map((service) => ({
  title: service.data.title,
  slug: service.slug,
  blurb: service.data.blurb,
  highlight: service.data.highlight,
}));

const locations = await getCollection("locations");
const featuredLocations = locations
  .slice()
  .sort((a, b) => a.data.city.localeCompare(b.data.city))
  .map((location) => ({
    city: location.data.city,
    slug: location.slug,
    county: location.data.county,
    blurb: location.data.blurb,
  }));

const reviews = await getCollection("reviews");
const decoratedReviews = reviews
  .slice()
  .sort((a, b) => b.data.published.getTime() - a.data.published.getTime())
  .map((review) => {
    const service = services.find((entry) => entry.slug === review.data.service);
    return {
      name: review.data.name,
      rating: review.data.rating,
      body: review.data.body,
      service: service?.data.title ?? service?.slug,
    };
  });

const galleryImages = [
  {
    src: "/images/native-pollinator-border.jpg",
    alt: "Venice native pollinator bed maintained by Jaime Goulet",
  },
  {
    src: "/images/native-buttonbush-landscape.jpg",
    alt: "Buttonbush blooms in a Sarasota shoreline planting",
  },
  {
    src: "/images/native-muhly-senna.jpg",
    alt: "Muhly grass and Chapman's senna swaying in coastal wind",
  },
];
---
<MainLayout>
  <HeroSection
    businessName="Tender Gardens"
    tagline="Venice-native gardens with heart"
    description="Hi, I’m Jaime Goulet—the native plant gardener-next-door keeping Venice and Sarasota spaces blooming with wildlife-friendly color. We plan, plant, and pamper every inch so you can enjoy the breeze while we handle the care."
    ctas={[
      { label: "Schedule a garden walk", href: "/contact", variant: "primary" },
      { label: "Explore services", href: "/services", variant: "secondary" },
    ]}
  />

  <TrustIndicators
    items={[
      { label: "Est. 2014", supportingText: "Owner-operated native plant care" },
      { label: "15 mi", supportingText: "Venice & Sarasota service radius" },
      { label: "100%", supportingText: "Florida native plants in every project" },
    ]}
  />

  <ServicesShowcase services={featuredServices} />

  <ServiceAreasGrid locations={featuredLocations} />

  <GalleryPreview images={galleryImages} />

  <ReviewsSpotlight reviews={decoratedReviews} />

  <CallToActionBanner
    title="Walk the garden with me?"
    description="Let’s stroll your space, sip something cold, and sketch the seasonal plan that keeps your native garden glowing without adding to your to-do list."
    primaryCta={{ label: "Plan my visit", href: "/contact" }}
    secondaryCta={{ label: "See service areas", href: "/service-areas" }}
  />
</MainLayout>
