---
import "../styles/global.css";
import SiteHeader from "../components/SiteHeader.astro";
import SiteFooter from "../components/SiteFooter.astro";

interface Props {
  title?: string;
  description?: string;
  ogImage?: string;
  structuredData?: Record<string, unknown> | Array<Record<string, unknown>>;
}

const {
  title = "Tender Gardens | Orlando Landscape & Garden Care",
  description = "Angie-inspired local studio crafting joyful landscapes, seasonal garden care, and outdoor styling for Central Florida homes and boutique spaces.",
  ogImage = "https://images.pexels.com/photos/450516/pexels-photo-450516.jpeg?auto=compress&cs=tinysrgb&w=1200&h=630&dpr=1",
  structuredData,
} = Astro.props satisfies Props;

const currentPath = Astro.url.pathname;
const site = Astro.site?.toString();
const canonicalUrl = site ? new URL(currentPath, site).toString() : undefined;
const jsonLd = Array.isArray(structuredData) ? structuredData : structuredData ? [structuredData] : [];
const gaId = import.meta.env.PUBLIC_GA_ID;
const gtmId = import.meta.env.PUBLIC_GTM_ID;
---
<!doctype html>
<html lang="en" class="min-h-full bg-[#fefbf1] text-[#111]">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
    <meta name="description" content={description} />
    {canonicalUrl && <link rel="canonical" href={canonicalUrl} />}
    <meta property="og:type" content="website" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    {canonicalUrl && <meta property="og:url" content={canonicalUrl} />}
    <meta property="og:image" content={ogImage} />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={ogImage} />
    {gaId && (
      <>
        <script async src={`https://www.googletagmanager.com/gtag/js?id=${gaId}`}></script>
        <script
          set:html={`window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', '${gaId}');`}
        ></script>
      </>
    )}
    {gtmId && (
      <script
        set:html={`(function(w,d,s,l,i){w[l]=w[l]||[];
w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});
var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),
    dl=l!='dataLayer'?'&l='+l:'';
j.async=true;
j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','${gtmId}');`}
      ></script>
    )}
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon@4.6.0/fonts/remixicon.css" />
    <link rel="icon" href="/favicon.svg" />
    {jsonLd.map((entry) => (
      <script type="application/ld+json" set:html={JSON.stringify(entry)} />
    ))}
  </head>
  <body class="min-h-screen bg-[#fefbf1] text-[#111]">
    {gtmId && (
      <noscript
        set:html={`<iframe src="https://www.googletagmanager.com/ns.html?id=${gtmId}" height="0" width="0" style="display:none;visibility:hidden"></iframe>`}
      />
    )}
    <a href="#main" class="sr-only focus:not-sr-only focus:absolute focus:left-4 focus:top-4 focus:z-50 focus:rounded-md focus:bg-white focus:px-4 focus:py-2 focus:text-sm focus:font-semibold">Skip to content</a>
    <SiteHeader currentPath={currentPath} />
    <main id="main" class="min-h-[60vh] pb-16">
      <slot />
    </main>
    <SiteFooter />
  </body>
</html>
